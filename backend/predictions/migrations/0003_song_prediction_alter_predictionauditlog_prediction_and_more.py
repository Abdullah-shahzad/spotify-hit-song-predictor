# Generated by Django 4.2.7 on 2025-12-16 20:06

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('predictions', '0002_alter_songprediction_title'),
    ]

    operations = [
        migrations.CreateModel(
            name='Song',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('record_type', models.CharField(choices=[('dataset', 'Training Dataset'), ('user_input', 'User Input')], db_index=True, default='user_input', help_text='Type of record: dataset entry or user input', max_length=20)),
                ('track_id', models.CharField(blank=True, db_index=True, help_text='Spotify track ID (extracted from URL if provided)', max_length=50, null=True)),
                ('track_name', models.CharField(blank=True, db_index=True, help_text='Song title', max_length=200, null=True)),
                ('artists', models.CharField(blank=True, db_index=True, help_text='Artist name(s)', max_length=300, null=True)),
                ('album_name', models.CharField(blank=True, help_text='Album name', max_length=200, null=True)),
                ('popularity', models.IntegerField(blank=True, db_index=True, help_text='Spotify popularity score (0-100)', null=True)),
                ('track_genre', models.CharField(blank=True, help_text='Genre', max_length=100, null=True)),
                ('data_source', models.CharField(blank=True, choices=[('dataset', 'Training Dataset'), ('spotify_api', 'Spotify API'), ('dataset_spotify', 'Dataset + Spotify Metadata')], help_text='Where audio features came from (only for user_input records)', max_length=20, null=True)),
                ('duration_ms', models.IntegerField(help_text='Duration in milliseconds')),
                ('duration_minutes', models.FloatField(blank=True, help_text='Duration in minutes (calculated)', null=True)),
                ('danceability', models.FloatField(help_text='0.0 to 1.0')),
                ('energy', models.FloatField(help_text='0.0 to 1.0')),
                ('valence', models.FloatField(help_text='0.0 to 1.0 (mood/positivity)')),
                ('mood', models.FloatField(blank=True, help_text='Same as valence, for compatibility', null=True)),
                ('acousticness', models.FloatField(help_text='0.0 to 1.0')),
                ('instrumentalness', models.FloatField(help_text='0.0 to 1.0')),
                ('speechiness', models.FloatField(blank=True, help_text='0.0 to 1.0', null=True)),
                ('liveness', models.FloatField(blank=True, help_text='0.0 to 1.0', null=True)),
                ('loudness', models.FloatField(help_text='dB value (typically -60 to 0)')),
                ('tempo', models.FloatField(help_text='BPM (beats per minute)')),
                ('mode', models.IntegerField(help_text='0=minor, 1=major')),
                ('key', models.IntegerField(blank=True, help_text='Musical key (0-11)', null=True)),
                ('time_signature', models.IntegerField(blank=True, help_text='Time signature (3, 4, 5, etc.)', null=True)),
                ('explicit', models.BooleanField(default=False, help_text='Explicit content flag')),
                ('is_acoustic', models.BooleanField(default=False, help_text='Derived: acousticness > 0.5')),
                ('is_instrumental', models.BooleanField(default=False, help_text='Derived: instrumentalness > 0.5')),
                ('is_hit', models.BooleanField(blank=True, db_index=True, help_text='HIT if popularity >= 50, FLOP otherwise (for dataset records)', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Song',
                'verbose_name_plural': 'Songs',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['track_id'], name='predictions_track_i_427b90_idx'), models.Index(fields=['track_name', 'artists'], name='predictions_track_n_6dd354_idx'), models.Index(fields=['record_type', 'created_at'], name='predictions_record__8eaed4_idx'), models.Index(fields=['popularity'], name='predictions_popular_f8c6e6_idx')],
            },
        ),
        migrations.CreateModel(
            name='Prediction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_hit', models.BooleanField(blank=True, db_index=True, help_text='Prediction: True=HIT, False=FLOP', null=True)),
                ('confidence', models.FloatField(blank=True, help_text='Prediction confidence %', null=True)),
                ('model_prediction', models.CharField(blank=True, help_text='Raw model prediction: HIT or FLOP', max_length=10, null=True)),
                ('model_confidence', models.FloatField(blank=True, help_text='Raw model confidence before adjustment', null=True)),
                ('adjusted_by_dataset', models.BooleanField(default=False, help_text='Whether prediction was adjusted based on dataset label')),
                ('dataset_label', models.CharField(blank=True, help_text='Dataset label if song was in dataset: HIT or FLOP', max_length=10, null=True)),
                ('dataset_popularity', models.IntegerField(blank=True, help_text='Popularity from dataset if available', null=True)),
                ('model_version', models.CharField(blank=True, help_text='Version of ML model used', max_length=50, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('song', models.ForeignKey(help_text='Song this prediction is for', on_delete=django.db.models.deletion.CASCADE, related_name='predictions', to='predictions.song')),
            ],
            options={
                'verbose_name': 'Prediction',
                'verbose_name_plural': 'Predictions',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AlterField(
            model_name='predictionauditlog',
            name='prediction',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='audit_logs', to='predictions.prediction'),
        ),
        migrations.DeleteModel(
            name='SongPrediction',
        ),
        migrations.AddIndex(
            model_name='prediction',
            index=models.Index(fields=['song', 'created_at'], name='predictions_song_id_b0b198_idx'),
        ),
        migrations.AddIndex(
            model_name='prediction',
            index=models.Index(fields=['is_hit'], name='predictions_is_hit_cf1568_idx'),
        ),
    ]
